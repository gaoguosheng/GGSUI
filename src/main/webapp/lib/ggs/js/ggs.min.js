var $GGS={contextPath:"",ajax:{sync:function(b,a){var d;$.ajax({type:"POST",url:b,data:a,async:!1,success:function(b){d=b}});return d},aSync:function(b,a,d){var g;$.ajax({type:"POST",url:b,data:a,async:!0,success:function(b){g=b;d()}});return g},getJSON:function(b,a){var d;$.ajax({type:"POST",url:b,data:a,async:!1,dataType:"json",success:function(b){d=b}});return d}},form:{enterDown:function(){var b=$(":input").length;$(":input").keypress(function(a){if(13==a.which)return a=$(":input").index(this)+
1,b==a&&(a=0),a=$(":input:eq("+a+")"),"submit"==$(a).attr("type")?$(a).click():$(a).focus(),!1})}},bootstrap:{navBar:function(b,a){var d=document.createElement("div");$(d).toggleClass("navbar");var g=document.createElement("div");$(g).toggleClass("navbar-inner");var k=this.nav(b);$(d).append(g);$(g).append(k);$("#"+a).append(d)},nav:function(b,a,d){function g(e,a){var k=!1,h;for(h in b)if(b[h].pId==e.id){k=!0;break}var l;k?(k=document.createElement("li"),$(k).toggleClass("dropdown"),$(k).append('<a href="#" class="dropdown-toggle" data-toggle="dropdown">'+
e.name+'<b class="caret-right"></b></a>'),l=document.createElement("ul"),$(l).toggleClass("dropdown-menu"),$(k).append(l)):k=d?"<li><a href='#' onclick='$GGS.bootstrap.addTab("+e.id+',"'+e.name+'","'+e.url+"\");'>"+e.name+"</a></li>":"<li><a href='"+e.url+"'>"+e.name+"</a></li>";$(a).append(k);for(h in b)b[h].pId==e.id&&g(b[h],$(l))}var k=document.createElement("ul");$(k).toggleClass("nav");(function(a){for(var f in b)if(b[f].pId==a){var r=b[f].id,h=b[f].name,l,q;l=!1;for(var p in b)if(b[p].pId==
r){l=!0;break}l?(l=document.createElement("li"),$(l).toggleClass("dropdown"),$(l).append('<a href="#" class="dropdown-toggle" data-toggle="dropdown">'+h+'<b class="caret"></b></a>'),q=document.createElement("ul"),$(l).append(q),$(q).toggleClass("dropdown-menu")):l=d?"<li><a href='#' onclick='$GGS.bootstrap.addTab("+r+',"'+h+'","'+b[f].url+"\");'>"+h+"</a></li>":"<li><a href='"+b[f].url+"' >"+h+"</a></li>";$(k).append(l);for(p in b)b[p].pId==r&&g(b[p],$(q))}})(0);a&&$("#"+a).append(k);return k},tabs:function(b){var a=
document.createElement("div");$(a).toggleClass("GGS-nav-tabs tabbable");var d=document.createElement("ul");$(d).toggleClass("nav nav-tabs");var g=document.createElement("div");$(g).toggleClass("tab-content");$(a).append(d);$(a).append(g);$("#"+b).append(a)},addTab:function(b,a,d,g){var k=$(".GGS-nav-tabs"),e=$('.GGS-nav-tabs a[href="#'+b+'"]');if(0<e.length)return e.tab("show"),!1;a="<li><a href='#"+b+"' data-toggle='tab' >"+a;g||(a+="&nbsp;&nbsp;<i title='\u5173\u95ed\u6807\u7b7e' class='close' onclick='$GGS.bootstrap.closeTab(\""+
b+"\");'>&times;</i>");k.find(".nav-tabs").append(a+"</a></li>");g=screen.availHeight-230;k.find(".tab-content").append("<div class='tab-pane' id='"+b+"'><iframe src='"+d+"' width='100%' height='"+g+"px' frameborder='0' scrolling='auto'></iframe></div>");e=$('.GGS-nav-tabs a[href="#'+b+'"]');e.tab("show")},closeTab:function(b){var a=$(".GGS-nav-tabs"),d=a.find(".nav-tabs li > a[href='#"+b+"']").parent().prev();a.find(".nav-tabs li > a[href='#"+b+"']").parent().remove();a.find(".tab-content div[id='"+
b+"']").remove();d.find("a").tab("show")},dialog:function(b){var a;a='<div class="GGS-dialog modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true" title="\u5173\u95ed\u7a97\u53e3">\u00d7</button>';a+="<h3></h3>";a+="</div>";a+='<div class="modal-body"></div>';a+='<div class="modal-footer"></div>';a+="</div>";var d=$("#"+b.id);0==d.length&&(d=document.createElement("div"),
$(d).attr("id",b.id),$(document.body).append(d));$(d).html(a);a=600;var g=300,k=20;b&&b.width&&(a=b.width);b&&b.height&&(g=b.height);b&&b.top&&(k=b.top);$(d).find(".GGS-dialog").css("width",a);$(d).find(".GGS-dialog").css("left",(screen.availWidth-a)/2+"px");$(d).find(".GGS-dialog").css("margin-left","0px");$(d).find(".GGS-dialog >.modal-body").css("height",g+"px");$(d).find(".GGS-dialog").css("top",k+"px");$(d).find(".GGS-dialog").css("margin-top","0px");$(d).find(".GGS-dialog >.modal-header >h3").html(b.title);
$(d).find(".GGS-dialog >.modal-header >h3").css("font-size","12pt");b.content?$(d).find(".GGS-dialog >.modal-body").html(b.content):b.url&&(a=$GGS.ajax.sync(b.url,b.data),$(d).find(".GGS-dialog >.modal-body").html(a));a=$(d).find(".GGS-dialog >.modal-footer");$(a).html("");if(g=b.buttons)for(var e in g)k=document.createElement("button"),$(k).toggleClass(g[e].className),$(k).html(g[e].name),$(k).click(g[e].click),$(a).append(k);e=!1;b.modal&&(e=!0);$(d).find(".GGS-dialog").modal({backdrop:e,keyboard:!0,
show:!0})},closeDialog:function(b){$("#"+b).find(".GGS-dialog").modal("hide")},alert:function(b){this.dialog({id:"ggs-alert",title:"\u63d0\u793a",content:b,width:350,height:60,buttons:[{name:"\u5173\u95ed",className:"btn",click:function(){$GGS.bootstrap.closeDialog("ggs-alert")}}]})},confirm:function(b,a){this.dialog({id:"ggs-confirm",title:"\u63d0\u793a",content:b,width:350,height:60,buttons:[{name:"\u786e\u5b9a",className:"btn btn-primary",click:function(){a();$GGS.bootstrap.closeDialog("ggs-confirm")}},
{name:"\u53d6\u6d88",className:"btn",click:function(){$GGS.bootstrap.closeDialog("ggs-confirm")}}]})},prcessBar:function(b,a,d){this.dialog({id:"ggs-prcessBar",title:b,content:'<div class="progress progress-striped active"><div class="bar" style="width: 0%;"></div></div>',top:150,width:350,height:40});var g=0,k=window.setInterval(function(){g+=300;var b=100*(g/d);$("#ggs-prcessBar .bar").css("width",b+"%");g>d&&(window.clearInterval(k),a(),$GGS.bootstrap.closeDialog("ggs-prcessBar"))},300)}},tips:function(b,
a){$._messengerDefaults={extraClasses:"messenger-fixed messenger-theme-ice  messenger-on-bottom messenger-on-right"};a||(a=3);$.globalMessenger().post({message:b,showCloseButton:!0,hideAfter:a})}};(function(){var b=window.Messenger,a;a=window.Messenger=function(){return a._call.apply(this,arguments)};window.Messenger.noConflict=function(){window.Messenger=b;return a}})();
window.Messenger._=function(){if(window._)return window._;var b=Array.prototype,a=b.slice,d=Object.prototype.toString,g=b.forEach,k=b.filter,b=Object.keys,e=Function.prototype.bind,f={},r={},h=f.each=f.forEach=function(b,a,e){if(null!=b)if(g&&b.forEach===g)b.forEach(a,e);else if(b.length===+b.length)for(var k=0,c=b.length;k<c&&a.call(e,b[k],k,b)!==r;k++);else for(k in b)if(f.has(b,k)&&a.call(e,b[k],k,b)===r)break};f.result=function(b,a){if(null==b)return null;var e=b[a];return f.isFunction(e)?e.call(b):
e};f.once=function(b){var a=!1,e;return function(){if(a)return e;a=!0;e=b.apply(this,arguments);b=null;return e}};var l=0;f.uniqueId=function(b){var a=++l+"";return b?b+a:a};f.filter=f.select=function(b,a,e){var f=[];if(null==b)return f;if(k&&b.filter===k)return b.filter(a,e);h(b,function(b,s,m){a.call(e,b,s,m)&&(f[f.length]=b)});return f};h("Arguments Function String Number Date RegExp".split(" "),function(b){f["is"+b]=function(a){return d.call(a)=="[object "+b+"]"}});f.defaults=function(b){h(a.call(arguments,
1),function(a){if(a)for(var e in a)null==b[e]&&(b[e]=a[e])});return b};f.extend=function(b){h(a.call(arguments,1),function(a){if(a)for(var e in a)b[e]=a[e]});return b};f.keys=b||function(b){if(b!==Object(b))throw new TypeError("Invalid object");var a=[],e;for(e in b)f.has(b,e)&&(a[a.length]=e);return a};f.bind=function(b,k){if(b.bind===e&&e)return e.apply(b,a.call(arguments,1));var f=a.call(arguments,2);return function(){return b.apply(k,f.concat(a.call(arguments)))}};f.isObject=function(b){return b===
Object(b)};return f}();
window.Messenger.Events=function(){return window.Backbone&&Backbone.Events?Backbone.Events:function(){var b=/\s+/,a=function(a,e,f,d){if(!f)return!0;if("object"===typeof f)for(var h in f)a[e].apply(a,[h,f[h]].concat(d));else if(b.test(f)){f=f.split(b);h=0;for(var g=f.length;h<g;h++)a[e].apply(a,[f[h]].concat(d))}else return!0},d=function(b,a){var f,d=-1,h=b.length;switch(a.length){case 0:for(;++d<h;)(f=b[d]).callback.call(f.ctx);break;case 1:for(;++d<h;)(f=b[d]).callback.call(f.ctx,a[0]);break;case 2:for(;++d<
h;)(f=b[d]).callback.call(f.ctx,a[0],a[1]);break;case 3:for(;++d<h;)(f=b[d]).callback.call(f.ctx,a[0],a[1],a[2]);break;default:for(;++d<h;)(f=b[d]).callback.apply(f.ctx,a)}},g={on:function(b,e,f){if(!a(this,"on",b,[e,f])||!e)return this;this._events||(this._events={});(this._events[b]||(this._events[b]=[])).push({callback:e,context:f,ctx:f||this});return this},once:function(b,e,f){if(!a(this,"once",b,[e,f])||!e)return this;var d=this,h=_.once(function(){d.off(b,h);e.apply(this,arguments)});h._callback=
e;this.on(b,h,f);return this},off:function(b,e,f){var d,h,g,q,p,v,t,c;if(!this._events||!a(this,"off",b,[e,f]))return this;if(!b&&!e&&!f)return this._events={},this;q=b?[b]:_.keys(this._events);p=0;for(v=q.length;p<v;p++)if(b=q[p],d=this._events[b]){g=[];if(e||f){t=0;for(c=d.length;t<c;t++)h=d[t],(e&&e!==h.callback&&e!==h.callback._callback||f&&f!==h.context)&&g.push(h)}this._events[b]=g}return this},trigger:function(b){if(!this._events)return this;var e=Array.prototype.slice.call(arguments,1);if(!a(this,
"trigger",b,e))return this;var f=this._events[b],g=this._events.all;f&&d(f,e);g&&d(g,arguments);return this},listenTo:function(b,a,f){var d=this._listeners||(this._listeners={}),g=b._listenerId||(b._listenerId=_.uniqueId("l"));d[g]=b;b.on(a,"object"===typeof a?this:f,this);return this},stopListening:function(b,a,f){var d=this._listeners;if(d){if(b)b.off(a,"object"===typeof a?this:f,this),!a&&!f&&delete d[b._listenerId];else{"object"===typeof a&&(f=this);for(var g in d)d[g].off(a,f,this);this._listeners=
{}}return this}}};g.bind=g.on;g.unbind=g.off;return g}()}();
(function(){var b,a,d,g,k,e,f,r,h,l={}.hasOwnProperty,q=function(b,a){function s(){this.constructor=b}for(var m in a)l.call(a,m)&&(b[m]=a[m]);s.prototype=a.prototype;b.prototype=new s;b.__super__=a.prototype;return b},p=[].slice,v=[].indexOf||function(b){for(var a=0,s=this.length;a<s;a++)if(a in this&&this[a]===b)return a;return-1};b=jQuery;e=null!=e?e:window.Messenger._;g=null!=(d="undefined"!==typeof Backbone&&null!==Backbone?Backbone.Events:void 0)?d:window.Messenger.Events;d=function(){function a(c){b.extend(this,
g);e.isObject(c)&&(c.el&&this.setElement(c.el),this.model=c.model);this.initialize.apply(this,arguments)}a.prototype.setElement=function(a){this.$el=b(a);return this.el=this.$el[0]};a.prototype.delegateEvents=function(b){var s,a,u,n,d,f;if(b||(b=e.result(this,"events"))){s=/^(\S+)\s*(.*)$/;this.undelegateEvents();f=[];for(u in b){d=b[u];e.isFunction(d)||(d=this[b[u]]);if(!d)throw Error("Method "+b[u]+" does not exist");n=u.match(s);a=n[1];n=n[2];d=e.bind(d,this);a+=".delegateEvents"+this.cid;""===
n?f.push(this.$el.on(a,d)):f.push(this.$el.on(a,n,d))}return f}};a.prototype.undelegateEvents=function(){return this.$el.off(".delegateEvents"+this.cid)};a.prototype.remove=function(){this.undelegateEvents();return this.$el.remove()};return a}();f=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}q(c,a);c.prototype.defaults={hideAfter:10,scroll:!0};c.prototype.initialize=function(a){null==a&&(a={});this.rendered=this.shown=!1;this.messenger=a.messenger;return this.options=
b.extend({},this.options,a,this.defaults)};c.prototype.show=function(){var b;this.rendered||this.render();this.$message.removeClass("messenger-hidden");b=this.shown;this.shown=!0;if(!b)return this.trigger("show")};c.prototype.hide=function(){var b;if(this.rendered&&(this.$message.addClass("messenger-hidden"),b=this.shown,this.shown=!1,b))return this.trigger("hide")};c.prototype.cancel=function(){return this.hide()};c.prototype.update=function(a){var m,c=this;e.isString(a)&&(a={message:a});b.extend(this.options,
a);this.lastUpdate=new Date;this.rendered=!1;this.events=null!=(m=this.options.events)?m:{};this.render();this.actionsToEvents();this.delegateEvents();this.checkClickable();this.options.hideAfter?(this.$message.addClass("messenger-will-hide-after"),null!=this._hideTimeout&&clearTimeout(this._hideTimeout),this._hideTimeout=setTimeout(function(){return c.hide()},1E3*this.options.hideAfter)):this.$message.removeClass("messenger-will-hide-after");if(this.options.hideOnNavigate){if(this.$message.addClass("messenger-will-hide-on-navigate"),
null!=("undefined"!==typeof Backbone&&null!==Backbone?Backbone.history:void 0))Backbone.history.on("route",function(){return c.hide()})}else this.$message.removeClass("messenger-will-hide-on-navigate");return this.trigger("update",this)};c.prototype.scrollTo=function(){if(this.options.scroll)return b.scrollTo(this.$el,{duration:400,offset:{left:0,top:-20}})};c.prototype.timeSinceUpdate=function(){return this.lastUpdate?new Date-this.lastUpdate:null};c.prototype.actionsToEvents=function(){var b,a,
c,n,e=this;c=this.options.actions;n=[];for(a in c)b=c[a],n.push(this.events['click [data-action="'+a+'"] a']=function(b){return function(s){s.preventDefault();s.stopPropagation();e.trigger("action:"+a,b,s);return b.action(s)}}(b));return n};c.prototype.checkClickable=function(){var b,a,c;a=this.events;c=[];for(b in a)"click"===b?c.push(this.$message.addClass("messenger-clickable")):c.push(void 0);return c};c.prototype.undelegateEvents=function(){var b;c.__super__.undelegateEvents.apply(this,arguments);
return null!=(b=this.$message)?b.removeClass("messenger-clickable"):void 0};c.prototype.parseActions=function(){var a,m,c,n;m=[];n=this.options.actions;for(c in n)a=n[c],a=b.extend({},a),a.name=c,null==a.label&&(a.label=c),m.push(a);return m};c.prototype.template=function(a){var m,c,n,e,d,f,g,k=this;n=b("<div class='messenger-message message alert "+a.type+" message-"+a.type+" alert-"+a.type+"'>");a.showCloseButton&&(c=b('<button type="button" class="close" data-dismiss="alert">&times;</button>'),
c.click(function(){k.cancel();return!0}),n.append(c));c=b('<div class="messenger-message-inner">'+a.message+"</div>");n.append(c);a.actions.length&&(m=b('<div class="messenger-actions">'));g=a.actions;d=0;for(f=g.length;d<f;d++)e=g[d],a=b("<span>"),a.attr("data-action",""+e.name),c=b("<a>"),c.html(e.label),a.append(b('<span class="messenger-phrase">')),a.append(c),m.append(a);n.append(m);return n};c.prototype.render=function(){var a;if(!this.rendered)return this._hasSlot||(this.setElement(this.messenger._reserveMessageSlot(this)),
this._hasSlot=!0),a=b.extend({},this.options,{actions:this.parseActions()}),this.$message=b(this.template(a)),this.$el.html(this.$message),this.rendered=this.shown=!0,this.trigger("render")};return c}(d);k=function(b){function a(){return a.__super__.constructor.apply(this,arguments)}q(a,b);a.prototype.initialize=function(){a.__super__.initialize.apply(this,arguments);return this._timers={}};a.prototype.cancel=function(){this.clearTimers();this.hide();if(null!=this._actionInstance&&null!=this._actionInstance.abort)return this._actionInstance.abort()};
a.prototype.clearTimers=function(){var b,a,c,n;c=this._timers;for(b in c)a=c[b],clearTimeout(a);this._timers={};return null!=(n=this.$message)?n.removeClass("messenger-retry-soon messenger-retry-later"):void 0};a.prototype.render=function(){var b,m,e,n;a.__super__.render.apply(this,arguments);this.clearTimers();e=this.options.actions;n=[];for(m in e)b=e[m],b.auto?n.push(this.startCountdown(m,b)):n.push(void 0);return n};a.prototype.renderPhrase=function(b,a){return b.phrase.replace("TIME",this.formatTime(a))};
a.prototype.formatTime=function(b){var a;a=function(b,a){b=Math.floor(b);1!==b&&(a+="s");return"in "+b+" "+a};if(0===Math.floor(b))return"now...";if(60>b)return a(b,"second");b/=60;return 60>b?a(b,"minute"):a(b/60,"hour")};a.prototype.startCountdown=function(b,a){var c,e,d,f,g=this;if(null==this._timers[b])return c=this.$message.find("[data-action='"+b+"'] .messenger-phrase"),e=null!=(f=a.delay)?f:3,10>=e?(this.$message.removeClass("messenger-retry-later"),this.$message.addClass("messenger-retry-soon")):
(this.$message.removeClass("messenger-retry-soon"),this.$message.addClass("messenger-retry-later")),d=function(){var f;c.text(g.renderPhrase(a,e));if(0<e)return f=Math.min(e,1),e-=f,g._timers[b]=setTimeout(d,1E3*f);g.$message.removeClass("messenger-retry-soon messenger-retry-later");delete g._timers[b];return a.action()},d()};return a}(f);r=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}q(c,a);c.prototype.tagName="ul";c.prototype.className="messenger";c.prototype.messageDefaults=
{type:"info"};c.prototype.initialize=function(a){this.options=null!=a?a:{};this.history=[];return this.messageDefaults=b.extend({},this.messageDefaults,this.options.messageDefaults)};c.prototype.render=function(){return this.updateMessageSlotClasses()};c.prototype.findById=function(b){return e.filter(this.history,function(a){return a.msg.options.id===b})};c.prototype._reserveMessageSlot=function(a){var c,e,d=this;c=b("<li>");c.addClass("messenger-message-slot");this.$el.prepend(c);this.history.push({msg:a,
$slot:c});this._enforceIdConstraint(a);for(a.on("update",function(){return d._enforceIdConstraint(a)});this.options.maxMessages&&this.history.length>this.options.maxMessages;)e=this.history.shift(),e.msg.remove(),e.$slot.remove();return c};c.prototype._enforceIdConstraint=function(b){var a,c,e,d;if(null!=b.options.id){d=this.history;c=0;for(e=d.length;c<e;c++)if(a=d[c],a=a.msg,null!=a.options.id&&a.options.id===b.options.id&&b!==a)if(b.options.singleton){b.hide();break}else a.hide()}};c.prototype.newMessage=
function(b){var a,c,e,d,g=this;null==b&&(b={});b.messenger=this;f=null!=(c=null!=(e=Messenger.themes[null!=(d=b.theme)?d:this.options.theme])?e.Message:void 0)?c:k;a=new f(b);a.on("show",function(){if(b.scrollTo&&"fixed"!==g.$el.css("position"))return a.scrollTo()});a.on("hide show render",this.updateMessageSlotClasses,this);return a};c.prototype.updateMessageSlotClasses=function(){var b,a,c,e,d,f,g;e=!0;a=null;b=!1;g=this.history;d=0;for(f=g.length;d<f;d++)c=g[d],c.$slot.removeClass("first last shown"),
c.msg.shown&&c.msg.rendered&&(c.$slot.addClass("shown"),b=!0,a=c,e&&(e=!1,c.$slot.addClass("first")));null!=a&&a.$slot.addClass("last");return this.$el[""+(b?"remove":"add")+"Class"]("messenger-empty")};c.prototype.hideAll=function(){var b,a,c,e,d;e=this.history;d=[];a=0;for(c=e.length;a<c;a++)b=e[a],d.push(b.msg.hide());return d};c.prototype.post=function(a){var c;e.isString(a)&&(a={message:a});a=b.extend(!0,{},this.messageDefaults,a);c=this.newMessage(a);c.update(a);return c};return c}(d);a=function(a){function c(){return c.__super__.constructor.apply(this,
arguments)}q(c,a);c.prototype.doDefaults={progressMessage:null,successMessage:null,errorMessage:"Error connecting to the server.",showSuccessWithoutError:!0,retry:{auto:!0,allow:!0},action:b.ajax};c.prototype.hookBackboneAjax=function(a){var c,d=this;null==a&&(a={});if(null==window.Backbone)throw"Expected Backbone to be defined";a=e.defaults(a,{id:"BACKBONE_ACTION",errorMessage:!1,successMessage:"Request completed successfully.",showSuccessWithoutError:!1});c=function(b){var c;c=e.extend({},a,b.messenger);
return d["do"](c,b)};if(null!=Backbone.ajax){Backbone.ajax._withoutMessenger&&(Backbone.ajax=Backbone.ajax._withoutMessenger);if(null==a.action||a.action===this.doDefaults.action)a.action=Backbone.ajax;c._withoutMessenger=Backbone.ajax;return Backbone.ajax=c}return Backbone.sync=e.wrap(Backbone.sync,function(){var a,e,d;d=arguments[0];a=2<=arguments.length?p.call(arguments,1):[];e=b.ajax;b.ajax=c;d.call.apply(d,[this].concat(p.call(a)));return b.ajax=e})};c.prototype._getMessage=function(b,a){return!1===
b?!1:!0===b||null==b||"string"!==typeof b?a:b};c.prototype._parseEvents=function(b){var a,c,e,d,f;null==b&&(b={});d={};for(e in b)c=b[e],a=e.indexOf(" "),f=e.substring(0,a),a=e.substring(a+1),null==d[f]&&(d[f]={}),d[f][a]=c;return d};c.prototype._normalizeResponse=function(){var b,a,c,d,f,g,k;c=1<=arguments.length?p.call(arguments,0):[];b=f=d=null;g=0;for(k=c.length;g<k;g++)a=c[g],"success"===a||"timeout"===a||"abort"===a?d=a:null!=(null!=a?a.readyState:void 0)&&null!=(null!=a?a.responseText:void 0)?
f=a:e.isObject(a)&&(b=a);return[d,b,f]};c.prototype.run=function(){var a,c,d,f,g,k,h,t,l,q,r=this;f=arguments[0];k=arguments[1];a=3<=arguments.length?p.call(arguments,2):[];null==k&&(k={});f=b.extend(!0,{},this.messageDefaults,this.doDefaults,null!=f?f:{});d=this._parseEvents(f.events);g=null!=(c=f.messageInstance)?c:this.newMessage(f);null!=f.id&&(g.options.id=f.id);null!=f.progressMessage&&g.update(b.extend({},f,{message:f.progressMessage,type:"info"}));e.each(["error","success"],function(c){var e,
h,m;if(null!=(h=k[c])&&h._originalHandler)k[c]=k[c]._originalHandler;e=null!=(m=k[c])?m:function(){};k[c]=function(){var h,m,t,l,q,w,x,y;m=1<=arguments.length?p.call(arguments,0):[];l=r._normalizeResponse.apply(r,m);t=l[0];l=l[2];"success"===c&&(null==g.errorCount&&!1===f.showSuccessWithoutError)&&(f.successMessage=null);"error"===c&&(null==f.errorCount&&(f.errorCount=0),f.errorCount+=1);m=r._getMessage(e.apply(null,m),f[c+"Message"]);if("error"===c&&(0===(null!=l?l.status:void 0)||"abort"===t))g.hide();
else if("error"===c&&null!=f.ignoredErrorCodes&&(q=null!=l?l.status:void 0,0<=v.call(f.ignoredErrorCodes,q)))g.hide();else return h=b.extend({},f,{message:m,type:c,events:null!=(w=d[c])?w:{},hideOnNavigate:"success"===c}),"number"===typeof(null!=(x=h.retry)?x.allow:void 0)&&h.retry.allow--,"error"===c&&500<=(null!=l?l.status:void 0)&&null!=(y=h.retry)&&y.allow?(null==h.retry.delay&&(h.retry.delay=4>h.errorCount?10:300),h.hideAfter&&(null==h._hideAfter&&(h._hideAfter=h.hideAfter),h.hideAfter=h._hideAfter+
h.retry.delay),h._retryActions=!0,h.actions={retry:{label:"retry now",phrase:"Retrying TIME",auto:h.retry.auto,delay:h.retry.delay,action:function(){h.messageInstance=g;return setTimeout(function(){return r["do"].apply(r,[h,k].concat(p.call(a)))},0)}},cancel:{action:function(){return g.cancel()}}}):h._retryActions&&(delete h.actions.retry,delete h.actions.cancel,delete f._retryActions),g.update(h),m?(b.globalMessenger(),g.show()):g.hide()};return k[c]._originalHandler=e});g._actionInstance=f.action.apply(f,
[k].concat(p.call(a)));h=["done","progress","fail","state","then"];t=0;for(l=h.length;t<l;t++)c=h[t],null!=g[c]&&delete g[c],g[c]=null!=(q=g._actionInstance)?q[c]:void 0;return g};c.prototype["do"]=c.prototype.run;c.prototype.ajax=function(){var a,c;c=arguments[0];a=2<=arguments.length?p.call(arguments,1):[];c.action=b.ajax;return this.run.apply(this,[c].concat(p.call(a)))};return c}(r);b.fn.messenger=function(){var d,c,f,g,h;c=arguments[0];d=2<=arguments.length?p.call(arguments,1):[];null==c&&(c=
{});return null==c||!e.isString(c)?(d=c,null==this.data("messenger")&&(r=null!=(f=null!=(g=Messenger.themes[d.theme])?g.Messenger:void 0)?f:a,this.data("messenger",f=new r(b.extend({el:this},d))),f.render()),this.data("messenger")):(h=this.data("messenger"))[c].apply(h,d)};window.Messenger._call=function(a){var c,d,e,f,g,h,k;a=b.extend({extraClasses:"messenger-fixed messenger-on-bottom messenger-on-right",theme:"future",maxMessages:9,parentLocations:["body"]},b._messengerDefaults,Messenger.options,
a);null!=a.theme&&(a.extraClasses+=" messenger-theme-"+a.theme);c=a.instance||Messenger.instance;if(null==a.instance){g=a.parentLocations;d=null;h=0;for(k=g.length;h<k;h++)if(f=g[h],d=b(f),d.length){e=f;break}c?b(c._location)!==b(e)&&(c.$el.detach(),d.prepend(c.$el)):(c=b("<ul>"),d.prepend(c),c=c.messenger(a),c._location=e,Messenger.instance=c)}null!=c._addedClasses&&c.$el.removeClass(c._addedClasses);c.$el.addClass(a=""+c.className+" "+a.extraClasses);c._addedClasses=a;return c};b.extend(Messenger,
{Message:k,Messenger:a,themes:null!=(h=Messenger.themes)?h:{}});b.globalMessenger=window.Messenger=Messenger}).call(this);
